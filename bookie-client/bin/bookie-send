#!/usr/bin/env ruby

#For development
$LOAD_PATH.concat Dir.glob(File.join(Dir.pwd, "../*/lib"))

#For development
ENV['TORQUEROOT'] = 'snapshot'

require 'bookie-client'

#for development
#config = Bookie::Config.new('/etc/bookie/config.json')
config = Bookie::Config.new('snapshot/config.json')

#For development
config.excluded_users = Set.new([])

config.connect

sender = Bookie::Client::LinuxSender.new(config)

#For development
sender.send_data(Date.new(2012, 10, 8))

if ARGV[0] == "--decommission"
  hostname = ARGV[1] || sender.hostname
  if ARGV[2]
    time = Time.parse(ARGV[2])
  else
    time = Time.new
  end
  sender.decommission(hostname, time)
end