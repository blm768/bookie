#!/usr/bin/env ruby

#For development
$LOAD_PATH.concat Dir.glob(File.join(Dir.pwd, "../*/lib"))

require 'bookie-client'

drop = false

def write_usage_and_exit
  $stderr.puts "Usage: bookie-create-tables [--drop]"
  exit 1
end

write_usage_and_exit if ARGV.length > 1

if ARGV[0]
  if ARGV[0] == '--drop'
    drop = true
  else
    write_usage_and_exit
  end
end

#For development
config = Bookie::Config.new('snapshot/config.json')
config.connect

if drop
  $stdout.write "Are you sure? This will destroy all tables in the database. "
  response = nil
  until response
    response = $stdin.gets.chomp
    case response
    when "YES"
      Bookie::Database::drop_tables
    when /NO/i
      exit 0
    else
      $stdout.write "Please answer 'YES' or 'NO'. "
      response = nil
    end
  end
else
  Bookie::Database::create_tables
end
