<h1>Jobs</h1>

<div id="tables">
  <table id="summary">
    <caption>Summary</caption>
    <tr>
      <th>Number of jobs</th>
      <td><%= @jobs.length %></td>
    </tr>
    <tr>
      <th>Total wall time</th>
      <td><%= total_wall_time %> seconds</td>
    </tr>
    <tr>
      <th>Total CPU time</th>
      <td><%= total_cpu_time %> seconds</td>
    </tr>
  </table>
  <table id="details">
    <caption>Details</caption>
    <tr>
      <th>User</th>
      <th>Group</th>
      <th>System</th>
      <th>System type</th>
      <th>Start time</th>
      <th>End time</th>
      <th>Wall time</th>
      <th>CPU time</th>
      <th>Memory</th>
      <th>Exit code</th>
    </tr>
    <% @jobs.each do |job| %>
      <tr>
        <td><%= job.user.name %></td>
        <td><%= job.user.group.name %></td>
        <td><%= job.system.name %></td>
        <td><%= job.system.system_type.name %></td>
        <td><%= job.start_time.strftime("%Y-%m-%d %H:%M:%S") %></td>
        <td><%= job.end_time.strftime("%Y-%m-%d %H:%M:%S") %></td>
        <td><%= job.wall_time %> sec</td>
        <td><%= job.cpu_time %> sec</td>
        <td><%= job.memory %>kb</td>
        <td><%= job.exit_code %></td>
      </tr>
    <% end %>
  </table>
</div>

<div id="controls">
  <h2>Filters</h2>
  <%= form_tag("/jobs", :method => "get") do %>
    <%= label_tag(:filter_type, "Filter by:") %>
    <%= select_tag(:filter_type, options({
        :none => "",
        :user => "User",
        :group => "Group",
        :start_time => "Start time",
        :end_time => "End time",
        :system => "System"},
        @last_filter).html_safe) %>
    </select>
    <span id="filter_extras">
      <%= text_field_tag(:filter_value, @last_filter_value) %>
    </span>
    <label for="sort_type">Sort by:</label>
    <%= select_tag(:sort, options({
      :none => "",
      :date => "Date",
      :wall_time => "Wall time"},
      @last_sort).html_safe) %> 
    <%= submit_tag("Submit") %>
  <% end %>
</div>


