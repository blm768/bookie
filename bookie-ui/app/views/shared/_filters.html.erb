<div id="controls">
  <h2>Filters</h2>
  <%= form_tag("", :method => "get", :id => "filter_form") do %>
    <span id="filters">
      <% if @prev_filters %>
        <% @prev_filters.each do |filter, values| %>
          <% filter_attributes = filter_types[filter] %>
          <% types = filter_attributes[:types] %>
          <div class="filter"><%= filter %><div class="filter_remover">X</div>
            <% values.each_index do |i| %>
              <% value = values[i] %>
              <% type = types[i] %>
              <% case type %>
              <% when :text %>
                <input type="<%= type %>" value="<%= value %>"></input>
              <% else %>
                <select value="<%= value %>"></select>
              <% end %>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </span>
    <select id="add_filter">
      <option value="">Add filter</option>
      <% filter_types.each do |name, data| %>
        <% #The value attribute is hijacked to hold the type of value associated with the filter. %>
        <option value="<%= data[:types].join(' ') %>"><%= name %></option> 
      <% end %>
    </select>
    <% if defined? default_details %>
      <label><%= check_box_tag("show_details", "true", default_details) %>Show details</label>
    <% end %>
    <%= submit_tag("Filter") %>
  <% end %>
</div>

