#!/usr/bin/env ruby

#For development
#$LOAD_PATH << 'lib'

require 'optparse'

require 'bookie/database'

config_file = ENV['BOOKIE_CONFIG'] || '/etc/bookie/config.json'
drop = false

opts = OptionParser.new do |opts|
  opts.banner = "bookie-create-tables [options]"
  
  opts.on('-c', '--config FILE', String, "use the given configuration file") do |file|
    config_file = file
  end
  
  opts.on("--drop", "drop all tables") do
    drop = true
  end
end
begin
  opts.parse!(ARGV)
rescue OptionParser::ParseError => e
  puts e.message
  puts opts
  exit 1
end

config = Bookie::Config.new(config_file)
config.connect

if drop
  STDOUT.write "Are you sure? This will destroy all tables in the database. (YES/NO): "
  response = nil
  until response
    response = STDIN.gets.chomp
    case response
    when "YES"
      Bookie::Database::Migration.down
    when /^NO$/i
      exit 0
    else
      $stdout.write "Please answer 'YES' or 'NO'. "
      response = nil
    end
  end
else
  Bookie::Database::Migration.up
end
