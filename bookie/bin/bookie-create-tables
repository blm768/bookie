#!/usr/bin/env ruby

#For development
$LOAD_PATH << 'lib'

require 'optparse'

require 'bookie/database'

config_file = '/etc/bookie/config.json'
drop = false

opts = OptionParser.new do |opts|
  opts.banner = "To do: usage instructions"
  
  opts.on('-c', '--config FILE', String, "use the given configuration file") do |file|
    config_file = file
  end
  
  opts.on("--drop", "drop all tables") do
    drop = true
  end
end
opts.parse!(ARGV)

config = Bookie::Config.new(config_file)
config.connect

if drop
  $stdout.write "Are you sure? This will destroy all tables in the database. "
  response = nil
  until response
    response = $stdin.gets.chomp
    case response
    when "YES"
      Bookie::Database::drop_tables
    when /^NO$/i
      exit 0
    else
      $stdout.write "Please answer 'YES' or 'NO'. "
      response = nil
    end
  end
else
  Bookie::Database::create_tables
end
